import{a as A,c as M,d as O,e as T}from"./chunk-XQDVAP6X.js";import{a as c}from"./chunk-JJYK6XMU.js";import{a as j,b as F}from"./chunk-MJU3WAKM.js";import"./chunk-ACJFTGJR.js";import"./chunk-VB5AKFTQ.js";import{h as I,i as W}from"./chunk-DYBTKUOF.js";import"./chunk-XXPNPBJG.js";import"./chunk-4ZDK5ED3.js";import{I as R,P as B,Q as z,g as P,h as v,p as w,r as x,t as U}from"./chunk-GAFZRVCH.js";import{Eb as D,Hc as g,Ic as S,Kb as d,O as b,Sb as k,Yb as m,bc as n,cc as a,dc as C,g as p,lc as _,mc as f,qb as y,sa as o,sb as l,wc as u}from"./chunk-32QSKDGA.js";function N(i,h){if(i&1&&(n(0,"div",1),C(1,"iframe",2),a()),i&2){let e=f(2);l(),k("src",e.pdfUrl,y)}}function E(i,h){i&1&&(n(0,"p"),u(1,"PDF bet\xF6lt\xE9se..."),a())}function $(i,h){if(i&1&&d(0,N,2,1,"div",1)(1,E,2,0,"p"),i&2){let e=f();m(e.pdfUrl?0:1)}}var pe=(()=>{class i{constructor(){this.workDocumentId=null,this.route=o(x),this.store=o(R),this.actions$=o(B),this.router=o(U),this.pdfService=o(M),this.pdfUrl=null,this.sanitizer=o(w),this.dialog=o(j)}ngOnInit(){this.routeSubscription=this.route.paramMap.subscribe(e=>{this.workDocumentId=e.get("workDocumentId"),this.workDocumentId&&(this.store.dispatch(c.loadByIid({iid:this.workDocumentId})),this.workDocument$=this.store.select(A),this.workDocument$.subscribe(t=>{t&&this.displayPdf(t)}))})}ngOnDestroy(){this.routeSubscription&&this.routeSubscription.unsubscribe(),this.pdfUrl&&typeof this.pdfUrl=="string"&&window.URL.revokeObjectURL(this.pdfUrl)}onDeleteWorkDocument(){if(!this.workDocumentId)return;this.dialog.open(F).afterClosed().subscribe(t=>{t&&(this.store.dispatch(c.deleteByIid({workDocumentIid:this.workDocumentId})),this.actions$.pipe(z(c.deleteByIidSuccess),b(1)).subscribe(()=>{this.router.navigate(["/"])}))})}generatePdfUrl(e){return p(this,null,function*(){try{let t=yield this.pdfService.generatePdfBlob(O(e.serialNumber,e.responsiblePerson,e.clientName,e.jobsDone,e.pesticides)),s=yield this.pdfService.generatePdfBlob(T(e.serialNumber,e.workSubject,e.workSubjectOther,e.workArt,this.pdfService.formatDate(e.workStartDate),this.pdfService.formatDate(e.workEndDate),e.clientNameForWorkPaper,e.scopeOfWork,e.pesticides)),r=yield this.pdfService.createA4LandscapeWithA5s(t,s),L=new Blob([r],{type:"application/pdf"});return window.URL.createObjectURL(L)}catch(t){return console.error("Failed to generate PDF URL:",t),null}})}displayPdf(e){return p(this,null,function*(){let t=yield this.generatePdfUrl(e);this.pdfUrl=t?this.sanitizer.bypassSecurityTrustResourceUrl(t):null})}static{this.\u0275fac=function(t){return new(t||i)}}static{this.\u0275cmp=D({type:i,selectors:[["app-workdocument"]],decls:5,vars:3,consts:[["nz-icon","","nzType","delete","nzTheme","outline",2,"color","red",3,"click"],[1,"iframeContainer"],["type","application/pdf",3,"src"]],template:function(t,s){if(t&1&&(n(0,"h2"),u(1,"F\u0151 adatok "),n(2,"span",0),_("click",function(){return s.onDeleteWorkDocument()}),a()(),d(3,$,2,1),g(4,"async")),t&2){let r;l(3),m((r=S(4,1,s.workDocument$))?3:-1,r)}},dependencies:[v,P,W,I],styles:[".iframeContainer[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.iframeContainer[_ngcontent-%COMP%]   iframe[_ngcontent-%COMP%]{border:1px solid #ccc;border-radius:4px;width:1200px;max-width:100%;height:870px}"]})}}return i})();export{pe as WorkDocumentComponent};
